<UserControl
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:ImageView"
    xmlns:local1="clr-namespace:Ty.Component.ImageControl"
    x:Class="ImageView.ImageViews" 
             mc:Ignorable="d" MouseDoubleClick="UserControl_MouseDoubleClick"
             d:DesignHeight="300" d:DesignWidth="800">
    <UserControl.Resources>

        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <!--自定义资源引用-->
                <ResourceDictionary Source="/ImageView;component/Theme/General.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <Storyboard x:Key="OnLoaded1"/>
            <Storyboard x:Key="OnMouseEnter1"/>

            <Storyboard x:Key="Sb_ShowTools">
                <ThicknessAnimationUsingKeyFrames Storyboard.TargetProperty="(FrameworkElement.Margin)" Storyboard.TargetName="border">
                    <EasingThicknessKeyFrame KeyTime="0:0:0.5" Value="0"/>
                </ThicknessAnimationUsingKeyFrames>
            </Storyboard>
            <Storyboard x:Key="Sb_HideTools">
                <ThicknessAnimationUsingKeyFrames Storyboard.TargetProperty="(FrameworkElement.Margin)" Storyboard.TargetName="border">
                    <EasingThicknessKeyFrame KeyTime="0:0:0.5" Value="0,0,0,-46"/>
                </ThicknessAnimationUsingKeyFrames>
            </Storyboard>
           
            <TransformGroup x:Key="TfGroup">
                <ScaleTransform/>
                <SkewTransform/>
                <RotateTransform Angle="0"/>
                <TranslateTransform/>
            </TransformGroup>
            <Storyboard x:Key="sb_Tips">
                <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Visibility)" Storyboard.TargetName="gridTips">
                    <DiscreteObjectKeyFrame KeyTime="0" Value="{x:Static Visibility.Visible}"/>
                    <DiscreteObjectKeyFrame KeyTime="0:0:0.8" Value="{x:Static Visibility.Visible}"/>
                    <DiscreteObjectKeyFrame KeyTime="0:0:1.3" Value="{x:Static Visibility.Collapsed}"/>
                </ObjectAnimationUsingKeyFrames>
                <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Opacity)" Storyboard.TargetName="gridTips">
                    <EasingDoubleKeyFrame KeyTime="0" Value="0"/>
                    <EasingDoubleKeyFrame KeyTime="0:0:0.5" Value="1"/>
                    <EasingDoubleKeyFrame KeyTime="0:0:1" Value="1"/>
                    <EasingDoubleKeyFrame KeyTime="0:0:1.3" Value="0"/>
                </DoubleAnimationUsingKeyFrames>
            </Storyboard>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid x:Name="grid_all" ClipToBounds="True">
        <ScrollViewer 
			x:Name="svImg"
			VerticalScrollBarVisibility="Hidden"
			HorizontalScrollBarVisibility="Hidden" >
            <Grid x:Name="rootGrid" Background="#FFDAD5D5">
                <!--<ContentControl x:Name="control" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,0,0,0">
                    <Image x:Name="imgBig" 
                           LayoutTransform="{StaticResource TfGroup}"  
                           HorizontalAlignment="Center" 
                           VerticalAlignment="Center" 
                           RenderTransformOrigin="0.5,0.5">
					</Image>
				</ContentControl>-->

                <ContentControl x:Name="control"  HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,0,0,0">
                    <Viewbox x:Name="vb" Stretch="Uniform" LayoutTransform="{StaticResource TfGroup}"   HorizontalAlignment="Center" VerticalAlignment="Center">
                        <Grid Background="Red"  HorizontalAlignment="Center" VerticalAlignment="Center">
                            <InkCanvas x:Name="canvas" Background="Red"
                           PreviewMouseLeftButtonDown="InkCanvas_MouseDown" 
                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                           MouseMove="InkCanvas_MouseMove" 
                           PreviewMouseUp="InkCanvas_MouseUp" 
                           MouseUp="InkCanvas_MouseUp"
                           Cursor="Cross" MinHeight="0" MinWidth="0"
                           ForceCursor="True" 
                           EditingMode="None" 
                          >
                                <InkCanvas.DefaultDrawingAttributes>
                                    <DrawingAttributes Color="Transparent"/>
                                </InkCanvas.DefaultDrawingAttributes>
                                <InkCanvas.RenderTransform>
                                    <RotateTransform Angle="0"/>
                                </InkCanvas.RenderTransform>
                                <!--<InkCanvas.Background>
                        <ImageBrush x:Name="imgBig" ImageSource="2-27.jpg"/>
                    </InkCanvas.Background>-->

                                <Image x:Name="imgBig"  Stretch="Uniform"/>

                                <!--<Image x:Name="imgBig"  Stretch="Uniform" Source="{Binding ImageSource}" />-->

                                <local1:DynamicShape x:Name="_dynamic" 
                                        Visibility="Collapsed" 
                                        WidthMatch="{Binding Source={StaticResource Resource.XmlDataProvider.ImageControl},XPath=DynamicMatch/@Width}"
                                        HeightMatch="{Binding Source={StaticResource Resource.XmlDataProvider.ImageControl},XPath=DynamicMatch/@Height}"/>

                                <!--<Rectangle x:Name="rectangle_clip" Visibility="Collapsed" 
                               Width="{Binding ElementName=canvas,Path=ActualWidth}" 
                               Height="{Binding ElementName=canvas,Path=ActualHeight}" 
>
                        <Rectangle.Fill>
                            <SolidColorBrush Color="LightGray" Opacity="0.9"/>
                        </Rectangle.Fill>
                    </Rectangle>-->

                            </InkCanvas>
                        </Grid>
                    </Viewbox>
                </ContentControl>

            </Grid>

        </ScrollViewer>
        
        <Grid x:Name="gridMouse"  Background="#19000000"/>

        <Grid Margin="0" Width="200" Height="200" HorizontalAlignment="Right" VerticalAlignment="Bottom" Background="#4C000000">
            <ContentControl x:Name="controlmask" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,0,0,0">
                <Image x:Name="imgless"  
                           LayoutTransform="{StaticResource TfGroup}" 
                           Margin="0" 
                           HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </ContentControl>

            <local:MaskCanvas x:Name="mask" 
                              Width="{Binding ActualWidth, ElementName=controlmask}"
                              Height="{Binding ActualHeight, ElementName=controlmask}" Margin="0"/>
        </Grid>
        <Border x:Name="border" BorderThickness="0" Margin="0,0,0,-46" VerticalAlignment="Bottom" HorizontalAlignment="Center" CornerRadius="5,5,0,0" Background="#66000000">
            <StackPanel HorizontalAlignment="Center" 
                        VerticalAlignment="Bottom" 
                        Height="46" Orientation="
                        Horizontal" 
                        Margin="0">
                <Button x:Name="btnActualsize" ToolTip="实际大小" Content="1:1" FontSize="20" Margin="10,0,5,0" Style="{DynamicResource ImageToolBtn}" Cursor="Hand"/>
                <Button x:Name="btnMacthsize" ToolTip="适应窗口" Click="BtnMacthsize_Click" FontSize="20" Margin="10,0,5,0" Style="{DynamicResource ImageToolBtn}" Cursor="Hand">
                    <Path Data="M960.605 932.345v-240.231c0.045-7.2-2.723-14.445-8.213-19.98-11.115-11.047-29.002-11.047-40.071 0-5.535 5.535-8.303 12.757-8.303 19.98v171.923l-351.99-352.035 351.99-352.013v171.855c0 7.245 2.767 14.49 8.303 20.002 11.070 11.070 28.957 11.070 40.071 0 5.49-5.511 8.257-12.78 8.213-20.002v-240.187c0.045-7.223-2.723-14.468-8.213-20.003-5.58-5.511-12.803-8.279-20.025-8.302h-240.233c-7.222 0-14.467 2.79-19.98 8.302-11.115 11.049-11.115 28.957 0 40.050 5.511 5.535 12.735 8.302 19.98 8.279h171.9l-352.013 352.013-352.012-352.035h171.855c7.268 0.022 14.49-2.745 20.025-8.279 11.070-11.047 11.070-29.002 0-40.050-5.49-5.511-12.758-8.279-20.025-8.303h-240.187c-7.268 0-14.513 2.79-20.025 8.303-5.513 5.558-8.279 12.803-8.279 20.048v240.165c0 7.245 2.79 14.512 8.279 20.002 11.070 11.070 28.98 11.070 40.028 0 5.513-5.511 8.279-12.713 8.279-20.002v-171.855l352.058 352.012-352.035 352.035v-171.922c0-7.2-2.745-14.445-8.279-19.98-11.070-11.047-29.002-11.047-40.028 0-5.558 5.535-8.279 12.757-8.279 19.98v240.231c0 7.223 2.79 14.468 8.279 20.048 5.535 5.468 12.757 8.279 20.025 8.279h240.188c7.268 0 14.49-2.745 20.025-8.279 11.070-11.047 11.070-29.002 0-40.050-5.535-5.535-12.78-8.257-20.025-8.257h-171.877l352.012-352.035 352.013 352.035h-171.9c-7.222 0-14.467 2.768-19.98 8.257-11.115 11.049-11.115 29.002 0 40.050 5.511 5.468 12.735 8.279 19.98 8.279h240.255c7.2 0 14.445-2.813 20.025-8.279 5.467-5.602 8.19-12.825 8.19-20.048z" Stretch="Uniform" Fill="{Binding Foreground, ElementName=btnMacthsize}" Margin="3,0" RenderTransformOrigin="0.5,0.5" Width="15" Height="18"/>
                </Button>


                <Button x:Name="btnEnlarge" ToolTip="图片放大" Margin="5,0" Style="{DynamicResource ImageToolBtn}" Cursor="Hand">
                    <Path Data="M5.673863,3.2889999 L7.0767274,3.2889999 7.0767274,5.72111 9.533,5.72111 9.533,7.1742001 7.0767274,7.1742001 7.0767274,9.6050006 5.673863,9.6050006 5.673863,7.1742001 3.217,7.1742001 3.217,5.72111 5.673863,5.72111 z M6.3070703,1.4097974 C5.4283705,1.4201729 4.5419398,1.6635488 3.7439018,2.1621917 1.4222865,3.6127289 0.71198823,6.6831284 2.1637352,9.0061189 3.6142719,11.327799 6.6833558,12.036217 9.0056105,10.58568 11.328476,9.1350423 12.037475,6.0659228 10.586278,3.7430426 9.6339302,2.2193809 7.9845882,1.3899893 6.3070703,1.4097974 z M6.4434238,0.0004323783 C8.542512,0.024875602 10.5856,1.0849572 11.780875,2.9968732 13.435871,5.6466618 12.898772,9.0321189 10.673577,11.066093 L14.180247,16.334451 C14.332647,16.566156 14.423984,16.872989 14.192785,17.026595 L12.872123,17.539151 C12.639724,17.691455 12.543241,17.309263 12.390841,17.077455 L9.2574797,12.023116 C6.3434468,13.511456 2.735364,12.577831 0.96906754,9.7522584 -0.89609847,6.766441 0.012133633,2.8340891 2.9977234,0.96947071 4.070725,0.29891717 5.2658859,-0.01327962 6.4434238,0.0004323783 z" Stretch="Uniform" Fill="{Binding Foreground, ElementName=btnEnlarge}" Margin="3,0" RenderTransformOrigin="0.5,0.5" Width="15" Height="18"/>
                </Button>
                <Button x:Name="btnNarrow" ToolTip="图片缩小" Margin="5,0" Style="{DynamicResource ImageToolBtn}" Cursor="Hand">
                    <Path Data="M3.218,5.7210003 L9.5319996,5.7210003 9.5319996,7.1739999 3.218,7.1739999 z M6.3070727,1.4097974 C5.4283724,1.4201729 4.5419379,1.6635488 3.7438889,2.1621917 1.4223012,3.6127289 0.71200206,6.6831284 2.1637604,9.0061189 3.6142586,11.327799 6.6833453,12.036217 9.0056019,10.58568 11.32857,9.1350423 12.03747,6.0659228 10.586271,3.7430426 9.6339226,2.2193809 7.9845915,1.3899893 6.3070727,1.4097974 z M6.443439,0.0004323783 C8.5425291,0.024875602 10.585629,1.0849572 11.78097,2.9968732 13.435867,5.6466618 12.898768,9.0321189 10.673571,11.066093 L14.269413,16.487474 C14.421811,16.719179 14.346851,16.910811 14.115652,17.064417 L13.000247,17.461768 C12.767848,17.614072 12.70392,17.603825 12.55152,17.372017 L9.2574721,12.023116 C6.3441758,13.511456 2.7353499,12.577831 0.96908184,9.7522584 -0.89611605,6.766441 0.0121469,2.8340891 2.9977396,0.96947071 4.0707422,0.29891717 5.2659006,-0.01327962 6.443439,0.0004323783 z" Stretch="Uniform" Fill="{Binding Foreground, ElementName=btnNarrow}" Margin="3,0" RenderTransformOrigin="0.5,0.5" Width="15" Height="18"/>
                </Button>
                <Button x:Name="btn_preview" ToolTip="上一张" Click="Btn_preview_Click" Margin="5,0" Style="{DynamicResource ImageToolBtn}" Cursor="Hand">
                    <Path Data="M778.965749 128.759549l-383.064442 383.063419 388.097062 388.096039-0.070608 0.033769c12.709463 13.137205 20.529569 31.024597 20.529569 50.731428 0 40.376593-32.736589 73.112158-73.115228 73.112158-19.705807 0-37.591153-7.819083-50.730405-20.528546l-0.034792 0.035816L241.890654 564.622498l0.035816-0.035816c-13.779841-13.281491-22.3838-31.915897-22.3838-52.585659 0-0.071631 0-0.106424 0-0.178055 0-0.072655 0-0.10847 0-0.144286 0-20.669762 8.603959-39.341007 22.3838-52.622498l-0.035816-0.034792L680.573835 20.337187l0.180102 0.179079c13.139252-12.5662 30.950919-20.313651 50.587142-20.313651 40.378639 0 73.115228 32.736589 73.115228 73.114205C804.455283 95.485725 794.567076 115.334795 778.965749 128.759549z" Stretch="Uniform" Fill="{Binding Foreground, ElementName=btn_preview}" Margin="3,0" RenderTransformOrigin="0.5,0.5" Width="15" Height="18"/>
                </Button>
                <Button x:Name="btn_next" ToolTip="下一张" Click="Btn_next_Click" Margin="5,0"  Style="{DynamicResource ImageToolBtn}" Cursor="Hand">
                    <Button.RenderTransform>
                        <RotateTransform CenterX="7.5" CenterY="23" Angle="180"/>
                    </Button.RenderTransform>
                    <Path Data="M778.965749 128.759549l-383.064442 383.063419 388.097062 388.096039-0.070608 0.033769c12.709463 13.137205 20.529569 31.024597 20.529569 50.731428 0 40.376593-32.736589 73.112158-73.115228 73.112158-19.705807 0-37.591153-7.819083-50.730405-20.528546l-0.034792 0.035816L241.890654 564.622498l0.035816-0.035816c-13.779841-13.281491-22.3838-31.915897-22.3838-52.585659 0-0.071631 0-0.106424 0-0.178055 0-0.072655 0-0.10847 0-0.144286 0-20.669762 8.603959-39.341007 22.3838-52.622498l-0.035816-0.034792L680.573835 20.337187l0.180102 0.179079c13.139252-12.5662 30.950919-20.313651 50.587142-20.313651 40.378639 0 73.115228 32.736589 73.115228 73.114205C804.455283 95.485725 794.567076 115.334795 778.965749 128.759549z" Stretch="Uniform" Fill="{Binding Foreground, ElementName=btn_next}" Margin="3,0" RenderTransformOrigin="0.5,0.5" Width="15" Height="18"/>
                </Button>
                <Button x:Name="btnRotate_left" Margin="5,0,10,0" ToolTip="向左旋转" Click="BtnRotate_left_Click" Style="{DynamicResource ImageToolBtn}" Cursor="Hand">
                    <Button.RenderTransform>
                        <ScaleTransform  CenterX="7.5" CenterY="23" ScaleX="-1"/>
                    </Button.RenderTransform>
                    <Path HorizontalAlignment="Center" Height="20" Margin="2,0" Stretch="Fill" Stroke="{Binding Foreground, ElementName=btnRotate_left}" VerticalAlignment="Center" Width="15" Fill="{Binding Foreground, ElementName=btnRotate_left}">
                        <Path.Data>
                            <PathGeometry>
                                <PathFigure IsFilled="False" StartPoint="16.2190003713877,19.6035522853233">
                                    <BezierSegment IsSmoothJoin="True" Point3="5.10457704168024,21.0735324544862" Point2="8.71361877552593,23.166809691682" Point1="13.2722301368137,22.5638931790653"/>
                                    <BezierSegment IsSmoothJoin="True" Point3="0.814570247855613,10.6688420983592" Point2="-0.264022957327099,14.7127427250565" Point1="1.49553588552836,18.9802552172904"/>
                                    <BezierSegment Point3="9.70832246424933,3.81300002336502" Point2="5.54096000659884,3.81300002336502" Point1="1.89316345303832,6.62494193594543"/>
                                </PathFigure>
                                <PathFigure IsClosed="True" StartPoint="10.2492547230302,0.500000004000907">
                                    <PolyLineSegment Points="10.218,6.438 13.937,3.562779"/>
                                </PathFigure>
                            </PathGeometry>
                        </Path.Data>
                    </Path>
                </Button>

                <Button x:Name="btnRotate" Margin="5,0,10,0" ToolTip="向右旋转" Style="{DynamicResource ImageToolBtn}" Cursor="Hand">
                    <Path HorizontalAlignment="Center" Height="20" Margin="2,0" Stretch="Fill" Stroke="{Binding Foreground, ElementName=btnRotate}" VerticalAlignment="Center" Width="15" Fill="{Binding Foreground, ElementName=btnRotate}">
                        <Path.Data>
                            <PathGeometry>
                                <PathFigure IsFilled="False" StartPoint="16.2190003713877,19.6035522853233">
                                    <BezierSegment IsSmoothJoin="True" Point3="5.10457704168024,21.0735324544862" Point2="8.71361877552593,23.166809691682" Point1="13.2722301368137,22.5638931790653"/>
                                    <BezierSegment IsSmoothJoin="True" Point3="0.814570247855613,10.6688420983592" Point2="-0.264022957327099,14.7127427250565" Point1="1.49553588552836,18.9802552172904"/>
                                    <BezierSegment Point3="9.70832246424933,3.81300002336502" Point2="5.54096000659884,3.81300002336502" Point1="1.89316345303832,6.62494193594543"/>
                                </PathFigure>
                                <PathFigure IsClosed="True" StartPoint="10.2492547230302,0.500000004000907">
                                    <PolyLineSegment Points="10.218,6.438 13.937,3.562779"/>
                                </PathFigure>
                            </PathGeometry>
                        </Path.Data>
                    </Path>
                </Button>

                <!--<CheckBox x:Name="cb_marktype" Content="设置标定模式" Foreground="White" VerticalAlignment="Center" Checked="Cb_marktype_Checked" Unchecked="Cb_marktype_Unchecked"/>-->

                <Button x:Name="btn_delete" ToolTip="删除" Click="Btn_delete_Click" Margin="5,0"  Style="{DynamicResource ImageToolBtn}" Cursor="Hand">
                    <Path Data="M878.54 226.544h-40.717v651.469c0 44.976-36.458 81.434-81.434 81.434H267.787c-44.976 0-81.434-36.458-81.434-81.434V226.544h-40.717c-22.488 0-40.717-18.229-40.717-40.717s18.229-40.717 40.717-40.717h244.301c0-44.976 36.458-81.434 81.434-81.434h81.434c44.976 0 81.434 36.458 81.434 81.434H878.54c22.488 0 40.717 18.229 40.717 40.717s-18.229 40.717-40.717 40.717z m-122.151 0H267.787v651.469h488.602V226.544z m-325.734 81.434c22.488 0 40.717 18.229 40.717 40.717v407.168c0 22.488-18.229 40.717-40.717 40.717s-40.717-18.229-40.717-40.717V348.695c0-22.488 18.229-40.717 40.717-40.717z m162.867 0c22.488 0 40.717 18.229 40.717 40.717v407.168c0 22.488-18.229 40.717-40.717 40.717s-40.717-18.229-40.717-40.717V348.695c0-22.488 18.229-40.717 40.717-40.717z" Stretch="Uniform" Fill="{Binding Foreground, ElementName=btn_delete}" Margin="3,0" RenderTransformOrigin="0.5,0.5" Width="15" Height="18"/>
                </Button>
                
                <CheckBox x:Name="btn_wheel" ToolTip="滚轮模式"  VerticalAlignment="Center" Margin="5,0" Cursor="Hand">

                    <!--<Path Data="M778.965749 128.759549l-383.064442 383.063419 388.097062 388.096039-0.070608 0.033769c12.709463 13.137205 20.529569 31.024597 20.529569 50.731428 0 40.376593-32.736589 73.112158-73.115228 73.112158-19.705807 0-37.591153-7.819083-50.730405-20.528546l-0.034792 0.035816L241.890654 564.622498l0.035816-0.035816c-13.779841-13.281491-22.3838-31.915897-22.3838-52.585659 0-0.071631 0-0.106424 0-0.178055 0-0.072655 0-0.10847 0-0.144286 0-20.669762 8.603959-39.341007 22.3838-52.622498l-0.035816-0.034792L680.573835 20.337187l0.180102 0.179079c13.139252-12.5662 30.950919-20.313651 50.587142-20.313651 40.378639 0 73.115228 32.736589 73.115228 73.114205C804.455283 95.485725 794.567076 115.334795 778.965749 128.759549z" Stretch="Uniform" Fill="{Binding Foreground, ElementName=btn_next}" Margin="3,0" RenderTransformOrigin="0.5,0.5" Width="15" Height="18"/>-->
                    <Canvas>
                        <Path Data="M204.8 341.333333v341.333334c0 169.710933 137.514667 307.2 307.2 307.2s307.2-137.5232 307.2-307.2V341.333333C819.2 171.6224 681.685333 34.133333 512 34.133333S204.8 171.656533 204.8 341.333333z m-34.133333 0C170.666667 152.823467 323.447467 0 512 0c188.509867 0 341.333333 152.746667 341.333333 341.333333v341.333334c0 188.509867-152.7808 341.333333-341.333333 341.333333-188.509867 0-341.333333-152.746667-341.333333-341.333333V341.333333z"/>
                        <Path Data="M187.733333 426.666667h648.533334v34.133333H187.733333zM494.933333 25.6h34.133334v341.333333h-34.133334z" />
                        <Path Data="M512 332.8m-34.133333 0a34.133333 34.133333 0 1 0 68.266666 0 34.133333 34.133333 0 1 0-68.266666 0Z"/>
                    </Canvas>
                </CheckBox>
            </StackPanel>
        </Border>
        <Grid x:Name="gridTips" IsHitTestVisible="False" HorizontalAlignment="Center" MinWidth="75" VerticalAlignment="Center" Visibility="Collapsed" Opacity="0">
            <Rectangle Fill="#B2000000" RadiusX="5" RadiusY="5"/>
            <TextBlock x:Name="txtZoom" HorizontalAlignment="Center" FontSize="18" Text="5%" VerticalAlignment="Center" Margin="10,5" Foreground="White"/>
        </Grid>

    </Grid>
</UserControl>
